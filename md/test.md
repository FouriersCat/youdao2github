
[TOC]



           
# 前言

&emsp;&emsp;时序约束是FPGA设计中最基本也是最重要的步骤之一，当然，也是难点之一。相信很多朋友都有过跟我一样的经历，看网上很多讲时序约束的文章，对建立/保持时间一顿分析，自己好不容易理解了，发现并不知道这东西在实际中怎么应用。而且网上的时序约束文章虽然不少，但没有一个系统的教程，大部分都是只言片语，因此就萌生了做一个详细的关于时序约束教程的想法。本教程综合整理了网上和书上关于时序约束的资料，在后面也有一章节是专门针对实际工程进行的时序约束，对于刚刚接触FPGA的同学来讲，相信会有不小的帮助，对于FPGA的老手来说，也希望能起到温故而知新的效果。好，废话不多说，开始正文。

本教程参考内容
 - 《vivado从此开始》
 - 《FPGA设计实战演练 高级技巧篇》
 - 《ee5375_timing_fpga》
 - Xilinx的各种UserGuide
 - 网上各个论坛（csdn、知乎、简书）
           

# 读万卷书--时序约束理论篇           
           
## 1. 周期约束理论

&emsp;&emsp;首先来看什么是时序约束，泛泛来说，就是我们告诉软件（Vivado、ISE等）从哪个pin输入信号，输入信号要延迟多长时间，时钟周期是多少，让软件PAR(Place and  Route)后的电路能够满足我们的要求。因此如果我们不加时序约束，软件是无法得知我们的时钟周期是多少，PAR后的结果是不会提示时序警告的。

&emsp;&emsp;周期约束就是告诉软件我们的时钟周期是多少，让它PAR后要保证在这样的时钟周期内时序不违规。大多数的约束都是周期约束，因为时序约束约的最多是时钟。

&emsp;&emsp;在讲具体的时序约束前，我们先介绍两个概念，在下面的讲解中，会多次用到：
 - 发起端/发起寄存器/发起时钟/发起沿：指的是产生数据的源端
 - 接收端/接收寄存器/捕获时钟/捕获沿：指的是接收数据的目的端

### 建立/保持时间

&emsp;&emsp;讲时序约束，这两个概念要首先介绍，因为周期约束其实就是为了满足建立/保持时间。对于DFF的输入而言，
 - 在clk上升沿到来之前，数据提前一个最小时间量“预先准备好”，这个最小时间量就是建立时间；
 - 在clk上升沿来之后，数据必须保持一个最小时间量“不能变化”，这个最小时间量就是保持时间。

<center>

![image](https://raw.githubusercontent.com/Bounce00/pic/master/fpga/timing_toturial0.png)

</center>

建立和保持时间是由器件特性决定了，当我们决定了使用哪个FPGA，就意味着建立和保持时间也就确定了。Xilinx FPGA的setup time基本都在0.04ns的量级，hold time基本在0.2ns的量级，不同器件会有所差异，具体可以查对应器件的DC and AC Switching Characteristics，下图列出K7系列的建立保持时间。

<center>

![image](https://raw.githubusercontent.com/Bounce00/pic/master/fpga/timing_toturial1.png)

</center>


